{% extends "base.html" %}
{% load static %}
{% block title %}Катлог игр{% endblock title %}
{% block content %}
<form id="filter-form" method="get">
  <div class="container mt-5">
    <div class="row mt-5 ms-auto">
      <div class="col-6">
        <h1 class='game_catalog_h'>КАТАЛОГ ИГР</h1>
      </div>
      <div class="col-3 search-container">
        <input type="text" name="search" class="form-control search-input" placeholder="Поиск" value="{{ request.GET.search }}" style='color: white'>
      </div>
      <div class="col-3">
        <select name="sort" class="form-control filter-select" onchange="this.form.submit()">
          <option value="">Порядок по:</option>
          <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Цена по возрастанию</option>
          <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>Цена по убыванию</option>
          <option value="name_asc" {% if request.GET.sort == 'name_asc' %}selected{% endif %}>Название (А-Я)</option>
          <option value="name_desc" {% if request.GET.sort == 'name_desc' %}selected{% endif %}>Название (Я-А)</option>
        </select>
      </div>
    </div>
  </div>

  <div class='container'>
    <div class="row mt-4">
      <div class="col-3">
        <select name="size" class="form-control filter-select custom-select" onchange="this.form.submit()">
          <option value="">Размер</option>
          {% for size in sizes %}
            <option value="{{ size.name }}" {% if request.GET.size == size.name %}selected{% endif %}>{{ size.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-3">
        <select name="players" class="form-control filter-select custom-select" onchange="this.form.submit()">
          <option value="">Количество игроков</option>
          {% for player_count in player_counts %}
            <option value="{{ player_count.count }}" {% if request.GET.players == player_count.count|stringformat:"s" %}selected{% endif %}>{{ player_count.count }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-3">
        <select name="age" class="form-control filter-select custom-select" onchange="this.form.submit()">
          <option value="">Возраст игроков</option>
          {% for player_age in player_ages %}
            <option value="{{ player_age.age }}" {% if request.GET.age == player_age.age %}selected{% endif %}>{{ player_age.age }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-3">
        <select name="type" class="form-control filter-select custom-select" onchange="this.form.submit()">
          <option value="">Вид игры</option>
          {% for game_type in game_types %}
            <option value="{{ game_type.name }}" {% if request.GET.type == game_type.name %}selected{% endif %}>{{ game_type.name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>

  <div class='container mt-1'>
    <div class='row mt-1'>
      {% if products %}
        {% for product in products %}
          <div class='col-3 mt-5'>
            <div class="game-card">
              <img src="{{ product.image.url }}" alt="{{ product.name }}" class="game_catalog_card">
              <h1 class='product_card_name'>{{ product.name }}</h1>
              <p class="product_card_price">
                {% with discounted_price=product.get_discounted_price %}
                  {% if discounted_price != product.price %}
                    <span class="original-price">{{ product.price|floatformat }} руб.</span>
                    <span class="discounted-price">{{ discounted_price|floatformat }} руб.</span>
                  {% else %}
                    {{ product.price|floatformat }} руб.
                  {% endif %}
                {% endwith %}
              </p>
              <a href="{% url 'product_detail' product.id %}" class="product_card_button">ПОДРОБНЕЕ</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="col-12 text-center mt-5">
          <img src="/media/icon/no_result.jfif" alt="" class="no_result_img mt-5">
          <h3 class='no_result_h'>По вашему запросу ничего не нашлось</h3>
        </div>
      {% endif %}
    </div>
  </div>

  <div class='container mt-5'>
    <h1 class='game_catalog_h'>ДОПОЛНИТЕЛЬНО</h1>
    <div class='row'>
      {% for additional_product in additional_products %}
        <div class='col-3 mt-5'>
          <div class="game-card">
            <img src="{{ additional_product.image.url }}" alt="{{ additional_product.name }}" class="game_catalog_card">
            <h1 class='product_card_name'>{{ additional_product.name }}</h1>
            <p class="product_card_price">
              {% with discounted_price=additional_product.get_discounted_price %}
                {% if discounted_price != additional_product.price %}
                  <span class="original-price">{{ additional_product.price|floatformat }} руб.</span>
                  <span class="discounted-price">{{ discounted_price|floatformat }} руб.</span>
                {% else %}
                  {{ additional_product.price|floatformat }} руб.
                {% endif %}
              {% endwith %}
            </p>
            <a href="#" class="product_card_button">ПОДРОБНЕЕ</a>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</form>
{% endblock content %}
