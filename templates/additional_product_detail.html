{% extends "base.html" %}
{% load static %}
{% load custom_filters %}
{% comment %} название игры {% endcomment %}
{% block title %}{{ additional_product.name }}{% endblock title %}
{% block content %}
{% if 'СУМКА' in additional_product.name or additional_product.name == 'ПОДСТАВКА ДЛЯ ИГР' %}
<div class="container mt-5">
    <!-- Десктопная версия -->
<div class="row mt-5 d-none d-md-flex" style='display: flex; flex-direction: row;'>
<div class='col-1'>
            {% for image in additional_product.additional_images.all %}
                <img src="{{ image.image.url }}" alt="Additional Image" class="additional_images" onclick="openProductModal('{{ additional_product.id }}')">
            {% endfor %}
        </div>
        <div class='col-6'>
            <img src="{{ additional_product.image.url }}" alt="Main Image" class="product_detail_image" onclick="openProductModal('{{ additional_product.id }}')">
        </div>
<div class='col-5' style="display: flex; flex-direction: column; justify-content: space-between;">
            <h1 class='product_detail_name'>{{ additional_product.name }}</h1>
            <p class='product_detail_description'>{{ additional_product.description }}</p>
            <p class='additional_detail_set'>ОПИСАНИЕ</p>
            <div class="additional-kit-container">
                {% for item in additional_product.game_kit_items_additional.all %}
                    <div class="additional-kit-item">
                        <div class="kit-content">
                            <span class="normal-text">{{ item.normal_text }}</span>
                            <span class="highlighted-text">{{ item.highlighted_text|safe|linebreaks }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class='product_detail_description'>{{ additional_product.description_2|safe|linebreaks }}</div>
<p class='additional_detail_price'>
  {% with discounted_price=additional_product.get_discounted_price %}
    {% if discounted_price != additional_product.price %}
<span class="product-detail-discounted-price">{{ additional_product.price_prefix|default_if_none:"" }} {{ discounted_price|format_price }} руб.</span>
<span class="product-detail-original-price">{{ additional_product.price_prefix|default_if_none:"" }} {{ additional_product.price|format_price }} руб.</span>
    {% else %}
      {{ additional_product.price_prefix|default_if_none:"" }} {{ additional_product.price|format_price }} руб.
    {% endif %}
  {% endwith %}
</p>
            <button class='product_detail_button' onclick="openOrderModal()">ЗАКАЗАТЬ</button>
        </div>
    </div>

    <!-- Мобильная версия -->
    <div class="row mt-5 d-md-none">
        <div class="col-12">
            <div class="swiper product-main-swiper-mobile">
                <div class="swiper-wrapper">
                    <!-- Основное изображение -->
                    <div class="swiper-slide">
                        <img src="{{ additional_product.image.url }}" alt="Main Image" class="product_detail_image">
                    </div>
                    <!-- Дополнительные изображения -->
                    {% for image in additional_product.additional_images.all %}
                        <div class="swiper-slide">
                            <img src="{{ image.image.url }}" alt="Additional Image" class="product_detail_image">
                        </div>
                    {% endfor %}
                </div>
                <!-- Кнопки навигации -->
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </div>
    </div>

    <!-- Описание и кнопка заказа для мобильной версии -->
    <div class="row mt-3 d-md-none">
        <div class="col-12">
            <h1 class='product_detail_name'>{{ additional_product.name }}</h1>
            <p class='product_detail_price'>
                {% with discounted_price=additional_product.get_discounted_price %}
                    {% if discounted_price != additional_product.price %}
                        <span class="product-detail-discounted-price">{{ additional_product.price_prefix|default_if_none:"" }} {{ discounted_price|format_price }} руб.</span>
                        <span class="product-detail-original-price">{{ additional_product.price_prefix|default_if_none:"" }} {{ additional_product.price|format_price }} руб.</span>
                    {% else %}
                        {{ additional_product.price_prefix|default_if_none:"" }} {{ additional_product.price|format_price }} руб.
                    {% endif %}
                {% endwith %}
            </p>
            <p class='product_detail_description'>{{ additional_product.description }}</p>
            <p class='additional_detail_set'>ОПИСАНИЕ</p>
            <div class="additional-kit-container-mobile">
                {% for item in additional_product.game_kit_items_additional.all %}
                    <div class="additional-kit-item-mobile">
                        <div class="kit-content">
                            <span class="normal-text">{{ item.normal_text }}</span>
                            <span class="highlighted-text">{{ item.highlighted_text|linebreaks }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class='product_detail_description'>{{ additional_product.description_2|safe|linebreaks }}</div>
            <button class='product_detail_button' onclick="openOrderModal()">ЗАКАЗАТЬ</button>
        </div>
    </div>

    <div class='container button-container'>
            <div class="button-row additional-button-row">
                <div class="button-info-container">
                    <button class="button" onclick="showInfo('info1')">МАТЕРИАЛ <img src="/media/icon/select_arrow.svg" alt="" class='arrow_accorderon'></button>
                </div>
                <div class="button-info-container">
                    <button class="button" onclick="showInfo('info2')">ДОСТАВКА <img src="/media/icon/select_arrow.svg" alt="" class='arrow_accorderon'></button>
                </div>
            </div>
<div id="info1" class="info-block">
                {{ additional_product.material|safe|linebreaks }}
            </div>
            <div id="info2" class="info-block">
                <p><b>Мы осуществляем доставку по всей территории России.</b></p>
                <ul>
                  <li>Обратите внимание, что стоимость доставки оплачивается заказчиком отдельно.</li>
                  <li>Мы сотрудничаем с надежной курьерскими службами, что позволяет обеспечить своевременное получение вами заказа.</li>
                  <li>Стоимость и сроки доставки зависят от вашего местоположения. После отправки заказа мы предоставим вам трек-номер для отслеживания статуса доставки в режиме онлайн. </li>
                  <li>Для оформления доставки добавьте соответствующую услугу в корзину при оформлении заказа и укажите точный адрес доставки. Наш сотрудник свяжется с вами для уточнения всех необходимых деталей.</li>
                </ul>
            </div>
    </div>

<div class='container mt-5' id='look-also-section'>
      <h1 class='game_catalog_h'>СМОТРИТЕ ТАКЖЕ</h1>
      <div class='row row_detail'>
        {% for product in products %}
          <div class='col-6 col-md-4 col-lg-3 mt-5'>
            <div class="game-card">
              <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product_detail_image_list">
              <h1 class='product_card_name'>{{ product.name }}</h1>
              <p class="product_card_price">{{ product.price|format_price }} руб.</p>
              <a href="{% url 'product_detail' pk=product.pk %}" class="product_card_button">ПОДРОБНЕЕ</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class='container mt-5' id='bought-together-section'>
      <h1 class='game_catalog_h'>С ЭТИМ ТОВАРОМ ПОКУПАЮТ</h1>
      <div class='row row_detail'>
        {% for additional_product in similar_additional_products %}
          <div class='col-6 col-md-4 col-lg-3 mt-5'>
            <div class="game-card">
              <img src="{{ additional_product.image.url }}" alt="{{ additional_product.name }}" class="product_detail_image_list">
              <h1 class='product_card_name'>{{ additional_product.name }}</h1>
              <p class="product_card_price">
                {% with discounted_price=additional_product.get_discounted_price %}
                  {% if discounted_price != additional_product.price %}
<span class="product-detail-discounted-price">{{ discounted_price|format_price }} руб.</span>
<span class="product-detail-original-price">{{ additional_product.price|format_price }} руб.</span>
                  {% else %}
                    {{ additional_product.price|format_price }} руб.
                  {% endif %}
                {% endwith %}
              </p>
              <a href="{% url 'additional_product_detail' pk=additional_product.pk %}" class="product_card_button">ПОДРОБНЕЕ</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>


{% comment %} версия для ГРАВИРОВКИ И ПОДАРОЧНОГО СЕРТИФИКАТА {% endcomment %}
{% elif additional_product.name == 'ГРАВИРОВКА' or 'ПОДАРОЧНЫЙ СЕРТИФИКАТ' in additional_product.name %}
<div class="container mt-5">
    <!-- Десктопная версия -->
<div class="row mt-5 d-none d-md-flex" style='display: flex; flex-direction: row;'>
  <div class='col-6'>
      <img src="{{ additional_product.image.url }}" alt="Main Image" class="product_detail_image" onclick="openProductModal('{{ additional_product.id }}')">
  </div>
<div class='col-6' style="display: flex; flex-direction: column; justify-content: space-between;">
            <h1 class='product_detail_name'>{{ additional_product.name }}</h1>
            <p class='product_detail_description'>{{ additional_product.description }}</p>
            {% if additional_product.name == 'ГРАВИРОВКА' %}
                <p class='additional_detail_set'>МЫ МОЖЕМ НАНЕСТИ:</p>
            {% else %}
                <p class='additional_detail_set'>ОПИСАНИЕ</p>
            {% endif %}
            <div class='product_detail_description'>{{ additional_product.description_2|safe|linebreaks }}</div>
<p class='additional_detail_price'>
  {% with discounted_price=additional_product.get_discounted_price %}
    {% if discounted_price != additional_product.price %}
<span class="product-detail-discounted-price">{{ additional_product.price_prefix|default_if_none:"" }} {{ discounted_price|format_price }} руб.</span>
<span class="product-detail-original-price">{{ additional_product.price_prefix|default_if_none:"" }} {{ additional_product.price|format_price }} руб.</span>
    {% else %}
      {{ additional_product.price_prefix|default_if_none:"" }} {{ additional_product.price|format_price }} руб.
    {% endif %}
  {% endwith %}
</p>
            <button class='product_detail_button' onclick="openOrderModal()">ЗАКАЗАТЬ</button>
        </div>
    </div>

<!-- Мобильная версия -->
<div class="row mt-5 d-md-none">
    <div class="col-12">
  <img src="{{ additional_product.image.url }}" alt="Main Image" class="product_detail_image" onclick="openProductModal('{{ additional_product.id }}')">
</div>
    <!-- Описание и кнопка заказа для мобильной версии -->
    <div class="row mt-3 d-md-none">
        <div class="col-12">
            <h1 class='product_detail_name'>{{ additional_product.name }}</h1>
            <p class='product_detail_price'>
                {% with discounted_price=additional_product.get_discounted_price %}
                    {% if discounted_price != additional_product.price %}
                        <span class="product-detail-discounted-price">{{ additional_product.price_prefix|default_if_none:"" }} {{ discounted_price|format_price }} руб.</span>
                        <span class="product-detail-original-price">{{ additional_product.price_prefix|default_if_none:"" }} {{ additional_product.price|format_price }} руб.</span>
                    {% else %}
                        {{ additional_product.price_prefix|default_if_none:"" }} {{ additional_product.price|format_price }} руб.
                    {% endif %}
                {% endwith %}
            </p>
            <p class='product_detail_description'>{{ additional_product.description }}</p>
            {% if additional_product.name == 'ГРАВИРОВКА' %}
                <p class='additional_detail_set'>МЫ МОЖЕМ НАНЕСТИ:</p>
            {% else %}
                <p class='additional_detail_set'>ОПИСАНИЕ</p>
            {% endif %}
            <div class='product_detail_description'>{{ additional_product.description_2|safe|linebreaks }}</div>
            <button class='product_detail_button' onclick="openOrderModal()">ЗАКАЗАТЬ</button>
        </div>
    </div>
</div>
<div class='container mt-5' id='look-also-section'>
      <h1 class='game_catalog_h'>СМОТРИТЕ ТАКЖЕ</h1>
      <div class='row row_detail'>
        {% for product in products %}
          <div class='col-6 col-md-4 col-lg-3 mt-5'>
            <div class="game-card">
              <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product_detail_image_list">
              <h1 class='product_card_name'>{{ product.name }}</h1>
              <p class="product_card_price">{{ product.price|format_price }} руб.</p>
              <a href="{% url 'product_detail' pk=product.pk %}" class="product_card_button">ПОДРОБНЕЕ</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class='container mt-5' id='bought-together-section'>
      <h1 class='game_catalog_h'>С ЭТИМ ТОВАРОМ ПОКУПАЮТ</h1>
      <div class='row row_detail'>
        {% for additional_product in similar_additional_products %}
          <div class='col-6 col-md-4 col-lg-3 mt-5'>
            <div class="game-card">
              <img src="{{ additional_product.image.url }}" alt="{{ additional_product.name }}" class="product_detail_image_list">
              <h1 class='product_card_name'>{{ additional_product.name }}</h1>
              <p class="product_card_price">
                {% with discounted_price=additional_product.get_discounted_price %}
                  {% if discounted_price != additional_product.price %}
<span class="product-detail-discounted-price">{{ discounted_price|format_price }} руб.</span>
<span class="product-detail-original-price">{{ additional_product.price|format_price }} руб.</span>
                  {% else %}
                    {{ additional_product.price|format_price }} руб.
                  {% endif %}
                {% endwith %}
              </p>
              <a href="{% url 'additional_product_detail' pk=additional_product.pk %}" class="product_card_button">ПОДРОБНЕЕ</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
{% endif %}
{% endblock content %}

{% block scripts %}
{{ block.super }}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    function adjustVisibleProducts() {
      const windowWidth = window.innerWidth;

      // Определяем количество отображаемых товаров в зависимости от ширины экрана
      let visibleCount;
      if (windowWidth >= 992) { // Десктоп
        visibleCount = 4;
      } else if (windowWidth >= 768) { // Планшет
        visibleCount = 3;
      } else { // Мобильные устройства
        visibleCount = 2;
      }

      // Обрабатываем раздел "СМОТРИТЕ ТАКЖЕ"
      const lookAlsoSection = document.getElementById('look-also-section');
      if (lookAlsoSection) {
        const lookAlsoProducts = lookAlsoSection.querySelectorAll('.row_detail .col-6');
        lookAlsoProducts.forEach((product, index) => {
          if (index < visibleCount) {
            product.style.display = '';
          } else {
            product.style.display = 'none';
          }
        });
      }

      // Обрабатываем раздел "С ЭТИМ ТОВАРОМ ПОКУПАЮТ"
      const boughtTogetherSection = document.getElementById('bought-together-section');
      if (boughtTogetherSection) {
        const boughtTogetherProducts = boughtTogetherSection.querySelectorAll('.row_detail .col-6');
        boughtTogetherProducts.forEach((product, index) => {
          if (index < visibleCount) {
            product.style.display = '';
          } else {
            product.style.display = 'none';
          }
        });
      }
    }

    // Вызываем функцию при загрузке страницы и при изменении размера окна
    adjustVisibleProducts();
    window.addEventListener('resize', adjustVisibleProducts);
  });
</script>

<!-- Модальное окно для продукта -->
<div id="productModal" class="news-modal">
  <span class="news-close" onclick="closeProductModal()">&times;</span>
  <div class="news-modal-content">
    <div class="news-carousel">
      <div class="product-carousel-inner">
        <!-- Слайды будут добавляться динамически -->
      </div>
      <button class="news-carousel-control prev" onclick="productPrevSlide()">&#10094;</button>
      <button class="news-carousel-control next" onclick="productNextSlide()">&#10095;</button>
    </div>
  </div>
</div>
<link rel="stylesheet" href="{% static 'css/product_modal.css' %}">
<script src="{% static 'js/product_modal.js' %}"></script>
{% endblock scripts %}
