<div id="orderModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Оформить заказ</h2>

    <form id="orderForm" method="post" action="/process_order/" onsubmit="return submitOrder(event)">
      {% csrf_token %}

      <div id="form-error" class="error-message" style="text-align: center; font-weight: bold; margin-bottom: 20px;"></div>

      <!-- Основные поля -->
      <div class="form-group">
        <label for="name">Ваше имя*</label>
        <input type="text" id="name" name="name" required>
        <div id="name-error" class="error-message">Пожалуйста, введите ваше имя</div>
      </div>

      <div class="form-group">
        <label for="phone">Телефон*</label>
        <input type="tel" id="phone" name="phone" required>
        <div id="phone-error" class="error-message">Пожалуйста, введите корректный номер телефона</div>
      </div>

      <div class="form-group">
        <label for="order-type">Тип заказа*</label>
        <select id="order-type" name="order_type" onchange="toggleOrderType(this.value)" required>
          <option value="">Выберите тип заказа</option>
          <option value="buy">Купить игру</option>
          <option value="rent">Арендовать игру</option>
        </select>
        <div id="order-type-error" class="error-message">Пожалуйста, выберите тип заказа</div>
      </div>

      <!-- Секция покупки -->
      <div id="buy-section" class="order-section" style="display: none;">
        <h3>Выбор игр для покупки</h3>

        <div class="games-grid" id="buy-games-container">
          <!-- Игры будут загружены динамически -->
          {% for product in products %}
            <div class="game-card">
              <label class="game-checkbox">
                <input type="checkbox" name="buy_games" value="{{ product.id }}"
                       data-name="{{ product.name }}" data-price="{{ product.price }}">
                <img src="{{ product.image.url }}" alt="{{ product.name }}"
                     onerror="this.src='/static/images/default-game.jpg'">
              </label>
              <div class="game-info">
                <h4>{{ product.name }}</h4>
                <p class="game-price">{{ product.price }} руб.</p>
              </div>
            </div>
          {% endfor %}
        </div>

        <h3>Дополнительные товары</h3>
        <div class="games-grid" id="additional-goods-container">
          <!-- Дополнительные товары будут загружены динамически -->
          {% for additional in additional_products %}
            <div class="game-card">
              <label class="game-checkbox">
                <input type="checkbox" name="additional_goods" value="{{ additional.id }}"
                       data-name="{{ additional.name }}" data-price="{{ additional.price }}">
                <img src="{{ additional.image.url }}" alt="{{ additional.name }}"
                     onerror="this.src='/static/images/default-game.jpg'">
              </label>
              <div class="game-info">
                <h4>{{ additional.name }}</h4>
                <p class="game-price">{{ additional.price }} руб.</p>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="form-group">
          <label for="engraving">Нужна гравировка?</label>
          <select id="engraving" name="engraving">
            <option value="no">Нет</option>
            <option value="yes">Да</option>
          </select>
        </div>

        <div class="form-group">
          <label for="delivery-address">Адрес доставки*</label>
          <input type="text" id="delivery-address" name="delivery_address">
          <div id="address-error" class="error-message">Пожалуйста, введите адрес доставки</div>
        </div>
      </div>

      <!-- Секция аренды -->
      <div id="rent-section" class="order-section" style="display: none;">
        <h3>Выбор игр для аренды</h3>

        <div class="games-grid" id="rent-games-container">
          <!-- Игры для аренды будут загружены динамически -->
          {% for product in products %}
            <div class="game-card">
              <label class="game-checkbox">
                <input type="checkbox" name="rent_games" value="{{ product.id }}"
                       data-name="{{ product.name }}">
                <img src="{{ product.image.url }}" alt="{{ product.name }}"
                     onerror="this.src='/static/images/default-game.jpg'">
              </label>
              <div class="game-info">
                <h4>{{ product.name }}</h4>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="form-group">
          <label for="rent-options">Тип аренды*</label>
          <select id="rent-options" name="rent_type" onchange="updateRentLimits()">
            <option value="">Выберите тип аренды</option>
            {% for arenda in arenda %}
              <option value="{{ arenda.id }}" data-game-count="{{ arenda.game_count }}" data-price="{{ arenda.price }}">
                {{ arenda.name }} ({{ arenda.game_count }} игр) - {{ arenda.price }} руб.
              </option>
            {% endfor %}
          </select>
          <div id="rent-options-error" class="error-message">Пожалуйста, выберите тип аренды</div>
        </div>

        <div class="form-group">
          <label for="rent-date">Дата аренды*</label>
          <input type="date" id="rent-date" name="rent_date">
          <div id="date-error" class="error-message">Пожалуйста, выберите дату аренды</div>
        </div>

        <div class="form-group">
          <label for="rent-address">Адрес доставки*</label>
          <input type="text" id="rent-address" name="rent_address">
          <div id="rent-address-error" class="error-message">Пожалуйста, введите адрес доставки</div>
        </div>

        <div class="form-group">
          <label for="comment">Комментарий</label>
          <textarea id="comment" name="comment" rows="3"></textarea>
        </div>
      </div>

      <div class="order-summary" style="display: none;">
        <h3>Итого к оплате: <span id="total-price">0</span> руб.</h3>
      </div>

      <button type="submit" id="submit-btn" class="submit-button">Оформить заказ</button>
    </form>
  </div>
</div>

<style>
  /* Стили для карточек игр */
  .games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
  }

  .game-card {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s;
    position: relative;
  }

  .game-card:hover {
    transform: translateY(-5px);
  }

  .game-card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
  }

  .game-info {
    padding: 10px;
    text-align: center;
  }

  .game-info h4 {
    margin: 5px 0;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .game-price {
    font-weight: bold;
    color: #e67e22;
    margin: 5px 0;
  }

  .game-checkbox {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
  }

  .game-checkbox input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }

  /* Стили для кнопки отправки */
  .submit-button {
    width: 100%;
    padding: 15px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 20px;
  }

  .submit-button:hover {
    background-color: #27ae60;
  }

  .submit-button:disabled {
    background-color: #95a5a6;
    cursor: not-allowed;
  }

  /* Стили для секций */
  .order-section {
    margin-top: 20px;
    padding: 20px;
    border: 1px solid #eee;
    border-radius: 8px;
    background-color: #f9f9f9;
  }

  /* Стили для итоговой суммы */
  .order-summary {
    margin-top: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 5px;
    text-align: right;
    font-size: 18px;
    font-weight: bold;
  }
</style>
