<div id="orderModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2 class="modal-title">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</h2>

    <form id="orderForm" method="post" action="/process_order/" onsubmit="return submitOrder(event)">
      {% csrf_token %}

      <div id="form-error" class="error-message" style="text-align: center; font-weight: bold; margin-bottom: 20px;"></div>

      <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è -->
      <div class="form-group">
        <input type="text" id="name" name="name" placeholder="–ò–º—è" required>
        <div id="name-error" class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è</div>
      </div>

      <div class="form-group">
        <input type="tel" id="phone" name="phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" required>
        <div id="phone-error" class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
      </div>

      <div class="form-group">
        <label for="order-type">–ß—Ç–æ –≤–∞—Å –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–æ?</label>
        <select id="order-type" name="order_type" onchange="toggleOrderType(this.value)" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–∫–∞–∑–∞</option>
          <option value="buy">–ö—É–ø–∏—Ç—å –∏–≥—Ä—É</option>
          <option value="rent">–ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å –∏–≥—Ä—É</option>
        </select>
        <div id="order-type-error" class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–∫–∞–∑–∞</div>
      </div>

      <!-- –°–µ–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ -->
      <div id="buy-section" class="order-section" style="display: none;">
        <h3 class="modal-title-section">–í—ã–±–æ—Ä –∏–≥—Ä –¥–ª—è –ø–æ–∫—É–ø–∫–∏</h3>

        <div class="games-grid" id="buy-games-container">
          <!-- –ò–≥—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          {% for product in products %}
          <div class="game-card-modal">
            <div class="game-checkbox">
              <input type="checkbox" name="selected_game" value="{{ product.id }}" data-price="{{ product.get_discounted_price }}">
            </div>
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            <div class="game-info">
              <h4>{{ product.name }}</h4>
              <p class="game-price">
                {% with discounted_price=product.get_discounted_price %}
                  {% if discounted_price != product.price %}
<span class="modal-original-price">{{ product.price|floatformat }} —Ä—É–±.</span>
<span class="modal-discounted-price">{{ discounted_price|floatformat }} —Ä—É–±.</span>
                  {% else %}
                    {{ product.price|floatformat }} —Ä—É–±.
                  {% endif %}
                {% endwith %}
              </p>
            </div>
          </div>
          {% endfor %}
        </div>

        <h3 class="modal-title-section">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
        <div class="games-grid" id="additional-goods-container">
          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          {% for additional in additional_products %}
          <div class="game-card-modal">
            <div class="game-checkbox">
              <input type="checkbox" name="selected_good" value="{{ additional.id }}" data-price="{{ additional.get_discounted_price }}">
            </div>
            <img src="{{ additional.image.url }}" alt="{{ additional.name }}">
            <div class="game-info">
              <h4>{{ additional.name }}</h4>
              <p class="game-price">
                {% with discounted_price=additional.get_discounted_price %}
                  {% if discounted_price != additional.price %}
<span class="modal-original-price">{{ additional.price|floatformat }} —Ä—É–±.</span>
<span class="modal-discounted-price">{{ discounted_price|floatformat }} —Ä—É–±.</span>
                  {% else %}
                    {{ additional.price|floatformat }} —Ä—É–±.
                  {% endif %}
                {% endwith %}
              </p>
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="form-group">
          <label for="engraving">–ù—É–∂–Ω–∞ –≥—Ä–∞–≤–∏—Ä–æ–≤–∫–∞?</label>
          <select id="engraving" name="engraving">
            <option value="no">–ù–µ—Ç</option>
            <option value="yes">–î–∞</option>
          </select>
        </div>

        <div class="form-group">
          <label for="delivery-address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
          <input type="text" id="delivery-address" name="delivery_address">
          <div id="address-error" class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
        </div>
      </div>

      <!-- –°–µ–∫—Ü–∏—è –∞—Ä–µ–Ω–¥—ã -->
      <div id="rent-section" class="order-section" style="display: none;">
<div class="form-group">
  <label for="order-type">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä</label>
  <select id="rent-options" name="rent_type" onchange="updateRentLimits()">
    <option value="">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä</option>
    {% for arenda in arenda %}
      <option value="{{ arenda.id }}" data-game-count="{{ arenda.game_count }}" data-price="{{ arenda.price }}">
        {{ arenda.name }} -
        {% with discounted_price=arenda.get_discounted_price %}
          {% if discounted_price != arenda.price %}
            <span class="rent-discounted-price">{{ discounted_price|floatformat }} —Ä—É–±.</span>
          {% else %}
            {{ arenda.price|floatformat }} —Ä—É–±.
          {% endif %}
        {% endwith %}
      </option>
    {% endfor %}
  </select>
  <div id="rent-options-error" class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∞—Ä–µ–Ω–¥—ã</div>
</div>

        <h3 class="modal-title-section">–í—ã–±–æ—Ä –∏–≥—Ä –¥–ª—è –∞—Ä–µ–Ω–¥—ã</h3>

        <div class="games-grid" id="rent-games-container">
          <!-- –ò–≥—Ä—ã –¥–ª—è –∞—Ä–µ–Ω–¥—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          {% for product in products %}
          <div class="game-card-modal">
            <div class="game-checkbox">
              <input type="checkbox" name="selected_rent_game" value="{{ product.id }}">
            </div>
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            <div class="game-info">
              <h4>{{ product.name }}</h4>
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="form-group">
          <label for="order-type">–í—ã–±–µ—Ä–µ—Ç–µ –¥–∞—Ç—É</label>
          <input type="date" id="rent-date" name="rent_date">
          <div id="date-error" class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∞—Ä–µ–Ω–¥—ã</div>
        </div>

        <div class="form-group">
          <label for="order-type">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
          <input type="text" id="rent-address" name="rent_address">
          <div id="rent-address-error" class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
        </div>

        <div class="form-group">
          <textarea id="comment" name="comment" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ÃÜ"></textarea>
        </div>
      </div>

      <div class="order-summary" style="display: none;">
        <h3>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: <span id="total-price">0</span> —Ä—É–±.</h3>
      </div>

      <button type="submit" id="submit-btn" class="submit-button">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
    </form>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div id="successModal" class="success-modal">
  <div class="success-modal-content">
    <span class="success-close" onclick="closeSuccessModal()">&times;</span>
    <div class="success-icon">üéâ</div>
    <h2 class="success-title">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
    <p class="success-message">–í–∞—à –∑–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
    <button class="success-ok-button" onclick="closeSuccessModal()">–•–æ—Ä–æ—à–æ</button>
  </div>
</div>
